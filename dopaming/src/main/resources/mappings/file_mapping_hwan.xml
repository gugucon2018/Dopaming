<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
                        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--mapper = dao -->
<mapper namespace="FileDAOHwan">

	<!-- 파일 등록 -->
	<insert id="file_insert_hwan">
		INSERT INTO file_upload(
		file_no,
		group_no,
		member_id,
		file_name,
		file_storage,
		upload_date
		)values(
		FILE_UPLOAD_SEQ_HWAN.nextval,
		#{groupNo},
		#{memberId},
		#{fileName},
		#{fileStorage},
		SYSDATE
		)
	</insert>

	<!-- 게시글 등록 -->
	<insert id="board_insert_hwan">
		<selectKey keyProperty="boardNo" resultType="int"
			order="BEFORE">
			select BOARD_INSERT_SEQ_HWAN.nextval from dual
		</selectKey>
		INSERT INTO board(
		board_no,
		board_title,
		member_id,
		category_big,
		category_small,
		board_content,
		board_img,
		board_acorn
		)values(
		#{boardNo},
		#{boardTitle},
		#{memberId},
		#{categoryBig},
		#{categorySmall},
		#{boardContent},
		#{boardImg},
		#{boardAcorn}
		)
	</insert>

	<!-- 게시글 열람 -->
	<select id="filePost_hwan"
		resultType="com.dopaming.www.file.FilePostVO_Hwan">
		select distinct b.board_no,
		b.category_big,b.category_small,b.board_acorn,b.member_id,b.board_content,b.board_title
		,b.board_img,sum(f.file_storage) as board_file_storage
		from board b
		inner join file_upload f
		on board_no = group_no inner join members m
		on
		m.member_id =b.member_id
		<where>
			<if test="board_no!=null and board_no !='' ">
				b.board_no=#{board_no}
			</if>
		</where>
		group by b.board_no, b.category_big, b.category_small, b.board_acorn,
		b.member_id, b.board_content,b.board_img,b.board_title

	</select>

	<!-- 게시글 파일리스트 -->
	<select id="Board_FileList"
		resultType="com.dopaming.www.file.FilePostVO_Hwan">
		select f.file_name as fileName_List
		from board b inner join file_upload
		f
		on b.board_no = f.group_no
		<where>
			<if test="board_no!=null and board_no!='' ">
				board_no=#{board_no}
			</if>
		</where>
	</select>

	<!-- 게시글에 게시글 열람 -->
	<select id="Board_BoardList"
		resultType="com.dopaming.www.file.FilePostVO_Hwan">
		select a.* from (select c.*, rownum rn from(
		select distinct
		b.board_no, b.board_title,
		b.member_id,b.category_big,b.category_small
		from board b inner join
		file_upload f
		on b.member_id = f.member_id
		<where>
			<if test="member_id!=null and member_id!='' ">
				b.member_id=#{member_id}
			</if>
		</where>
		) c ) a where rn between #{first} and #{last}
	</select>

	<!-- 게시글에 게시글 페이징 -->
	<select id="Board_Paging" resultType="int">
		select count(distinct b.board_no)
		from board b inner join file_upload f
		on b.member_id = f.member_id
		<where>
			<if test="member_id!=null and member_id!='' ">
				b.member_id=#{member_id}
			</if>
		</where>
	</select>
	<!-- 다운로드 게시글 리스트 열람 -->
	<select id="Download_List"
		resultType="com.dopaming.www.file.FileDownloadVO_Hwan">
		select distinct m.member_id,
		b.board_acorn, f.file_no, f.group_no,
		f.file_storage,f.file_name
		from members m inner join file_upload f
		on
		m.member_id = f.member_id inner join board b
		on m.member_id
		=b.member_id
		<where>
			<if test="group_no!=null and group_no!='' ">
				group_no=#{group_no}
			</if>
		</where>
	</select>
	<!-- 다운로드 게시글 열람 -->
	<select id="DownloadPost"
		resultType="com.dopaming.www.file.FileDownloadVO_Hwan">
		select distinct b.member_id, b.board_acorn,f.group_no
		from board b
		inner join file_upload f
		on b.member_id = f.member_id
		<where>
			<if test="group_no!=null and group_no!='' ">
				f.group_no=#{group_no}
			</if>
		</where>
		group by b.member_id,b.board_acorn, f.file_no, f.group_no
	</select>
	<!-- 댓글 추가 -->
	<insert id="CommentInsert">
	insert into comments(
		comment_no,
		comment_content,
		member_id,
		reg_date,
		board_no
	)values(
		#{comment_no},
		#{comment_content},
		'lion',
		SYSDATE,
		#{board_no}
	)	
	</insert>
</mapper>